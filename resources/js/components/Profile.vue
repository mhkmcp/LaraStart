<style lang="">
/* .widget-user-header {
    background-position: center center;
    background-size: cover;
} */
</style>

<template>
    <div class="container">
        <div class="row ">
            <div class="col-md-12 ">
                <div class="card card-widget widget-user">
                    <!-- Add the bg color to the header using any of the bg-* classes -->
                    <div
                        class="widget-user-header text-white"
                        style="background: url('img/back.jpg') center center;"
                    >
                        <h3 class="widget-user-username text-right">
                            Humayun Kabir
                        </h3>
                        <h5 class="widget-user-desc text-right">
                            Web Developer
                        </h5>
                    </div>
                    <div class="widget-user-image">
                        <img
                            class="img-circle"
                            :src="getProfilePhoto()"
                            alt="User Avatar"
                        />
                    </div>
                    <div class="card-footer">
                        <div class="row">
                            <div class="col-sm-4 border-right">
                                <div class="description-block">
                                    <h5 class="description-header">3,200</h5>
                                    <span class="description-text">SALES</span>
                                </div>
                                <!-- /.description-block -->
                            </div>
                            <!-- /.col -->
                            <div class="col-sm-4 border-right">
                                <div class="description-block">
                                    <h5 class="description-header">13,000</h5>
                                    <span class="description-text"
                                        >FOLLOWERS</span
                                    >
                                </div>
                                <!-- /.description-block -->
                            </div>
                            <!-- /.col -->
                            <div class="col-sm-4">
                                <div class="description-block">
                                    <h5 class="description-header">35</h5>
                                    <span class="description-text"
                                        >PRODUCTS</span
                                    >
                                </div>
                                <!-- /.description-block -->
                            </div>
                            <!-- /.col -->
                        </div>
                        <!-- /.row -->
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <ul class="nav nav-pills">
                            <li class="nav-item">
                                <a
                                    class="nav-link"
                                    href="#activity"
                                    data-toggle="tab"
                                    >Activity</a
                                >
                            </li>
                            <li class="nav-item">
                                <a
                                    class="nav-link"
                                    href="#settings"
                                    data-toggle="tab"
                                    >Settings</a
                                >
                            </li>
                        </ul>
                    </div>
                    <!-- /.card-header -->
                    <div class="card-body">
                        <div class="tab-content">
                            <div class="tab-pane" id="activity">
                                <!-- Post -->
                                <div class="post">
                                    <div class="user-block">
                                        <img
                                            class="img-circle img-bordered-sm"
                                            src="img/me.jpg"
                                            alt="user image"
                                        />
                                        <span class="username">
                                            <a href="#">Jonathan Burke Jr.</a>
                                            <a
                                                href="#"
                                                class="float-right btn-tool"
                                                ><i class="fas fa-times"></i
                                            ></a>
                                        </span>
                                        <span class="description"
                                            >Shared publicly - 7:30 PM
                                            today</span
                                        >
                                    </div>
                                    <!-- /.user-block -->
                                    <p>
                                        Lorem ipsum represents a long-held
                                        tradition for designers, typographers
                                        and the like. Some people hate it and
                                        argue for its demise, but others ignore
                                        the hate as they create awesome tools to
                                        help create filler text for everyone
                                        from bacon lovers to Charlie Sheen fans.
                                    </p>

                                    <p>
                                        <a
                                            href="#"
                                            class="link-black text-sm mr-2"
                                            ><i class="fas fa-share mr-1"></i>
                                            Share</a
                                        >
                                        <a href="#" class="link-black text-sm"
                                            ><i
                                                class="far fa-thumbs-up mr-1"
                                            ></i>
                                            Like</a
                                        >
                                        <span class="float-right">
                                            <a
                                                href="#"
                                                class="link-black text-sm"
                                            >
                                                <i
                                                    class="far fa-comments mr-1"
                                                ></i>
                                                Comments (5)
                                            </a>
                                        </span>
                                    </p>

                                    <input
                                        class="form-control form-control-sm"
                                        type="text"
                                        placeholder="Type a comment"
                                    />
                                </div>
                                <!-- /.post -->

                                <!-- Post -->
                                <div class="post clearfix">
                                    <div class="user-block">
                                        <img
                                            class="img-circle img-bordered-sm"
                                            src="img/me.jpg"
                                            alt="User Image"
                                        />
                                        <span class="username">
                                            <a href="#">Sarah Ross</a>
                                            <a
                                                href="#"
                                                class="float-right btn-tool"
                                                ><i class="fas fa-times"></i
                                            ></a>
                                        </span>
                                        <span class="description"
                                            >Sent you a message - 3 days
                                            ago</span
                                        >
                                    </div>
                                    <!-- /.user-block -->
                                    <p>
                                        Lorem ipsum represents a long-held
                                        tradition for designers, typographers
                                        and the like. Some people hate it and
                                        argue for its demise, but others ignore
                                        the hate as they create awesome tools to
                                        help create filler text for everyone
                                        from bacon lovers to Charlie Sheen fans.
                                    </p>

                                    <form class="form-horizontal">
                                        <div
                                            class="input-group input-group-sm mb-0"
                                        >
                                            <input
                                                class="form-control form-control-sm"
                                                placeholder="Response"
                                            />
                                            <div class="input-group-append">
                                                <button
                                                    type="submit"
                                                    class="btn btn-danger"
                                                >
                                                    Send
                                                </button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <!-- /.post -->
                            </div>
                            <!-- /.tab-pane -->
                            <!-- timeline pane  -->
                            <!-- /.tab-pane -->

                            <div class="tab-pane" id="settings">
                                <form class="form-horizontal">
                                    <div class="form-group row">
                                        <label
                                            for="inputName"
                                            class="col-sm-2 col-form-label"
                                            >Name</label
                                        >
                                        <div class="col-sm-10">
                                            <input
                                                type="text"
                                                v-model="form.name"
                                                class="form-control"
                                                id="inputName"
                                                placeholder="Name"
                                                :class="{
                                                    'is-invalid': form.errors.has(
                                                        'name'
                                                    )
                                                }"
                                            />
                                            <has-error
                                                :form="form"
                                                field="name"
                                            ></has-error>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label
                                            for="inputEmail"
                                            class="col-sm-2 col-form-label"
                                            >Email</label
                                        >
                                        <div class="col-sm-10">
                                            <input
                                                type="email"
                                                v-model="form.email"
                                                class="form-control"
                                                id="inputEmail"
                                                placeholder="Email"
                                                :class="{
                                                    'is-invalid': form.errors.has(
                                                        'email'
                                                    )
                                                }"
                                            /><has-error
                                                :form="form"
                                                field="email"
                                            ></has-error>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label
                                            for="inputName2"
                                            class="col-sm-2 col-form-label"
                                            >Type</label
                                        >
                                        <div class="col-sm-10">
                                            <select
                                                name="type"
                                                v-model="form.type"
                                                id="type"
                                                class="form-control"
                                                :class="{
                                                    'is-invalid': form.errors.has(
                                                        'type'
                                                    )
                                                }"
                                            >
                                                <has-error
                                                    :form="form"
                                                    field="type"
                                                ></has-error>
                                                <option
                                                    value="admin"
                                                    v-if="form.type === 'admin'"
                                                    selected
                                                    >Admin</option
                                                >
                                                <option value="admin" v-else
                                                    >Admin</option
                                                >
                                                <option
                                                    value="author"
                                                    v-if="
                                                        form.type === 'author'
                                                    "
                                                    selected
                                                    >Author</option
                                                >
                                                <option value="author" v-else
                                                    >Author</option
                                                >
                                                <option
                                                    value="user"
                                                    v-if="
                                                        form.type ===
                                                            'standard user'
                                                    "
                                                    selected
                                                    >Standard User</option
                                                >

                                                <option value="user" v-else
                                                    >Standard User</option
                                                >
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label
                                            for="inputExperience"
                                            class="col-sm-2 col-form-label"
                                            >Bio</label
                                        >
                                        <div class="col-sm-10">
                                            <textarea
                                                class="form-control"
                                                v-model="form.bio"
                                                id="inputExperience"
                                                placeholder="Bio"
                                                :class="{
                                                    'is-invalid': form.errors.has(
                                                        'bio'
                                                    )
                                                }"
                                            ></textarea
                                            ><has-error
                                                :form="form"
                                                field="bio"
                                            ></has-error>
                                        </div>
                                    </div>
                                    <!-- <div class="form-group row">
                                        <label
                                            for="inputSkills"
                                            class="col-sm-2 col-form-label"
                                            >Skills</label
                                        >
                                        <div class="col-sm-10">
                                            <input
                                                type="text"
                                                class="form-control"
                                                id="inputSkills"
                                                placeholder="Skills"
                                            />
                                        </div>
                                    </div> -->
                                    <div class="form-group row">
                                        <label for="photo" class="col-sm-2"
                                            >Profile Photo</label
                                        >
                                        <div class="col-sm-10">
                                            <input
                                                type="file"
                                                @change="updateProfile"
                                                name="photo"
                                                class="form-input"
                                                :class="{
                                                    'is-invalid': form.errors.has(
                                                        'photo'
                                                    )
                                                }"
                                            />
                                            <has-error
                                                :form="form"
                                                field="photo"
                                            ></has-error>
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <label
                                            for="password"
                                            class="col-sm-2 control-label"
                                            >Password (leave empty if not
                                            changing)</label
                                        >

                                        <div class="col-sm-10">
                                            <input
                                                type="password"
                                                class="form-control"
                                                id="password"
                                                placeholder="Password"
                                                :class="{
                                                    'is-invalid': form.errors.has(
                                                        'password'
                                                    )
                                                }"
                                            />
                                            <has-error
                                                :form="form"
                                                field="password"
                                            ></has-error>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="offset-sm-2 col-sm-10">
                                            <button
                                                type="submit"
                                                @click.prevent="updateInfo"
                                                class="btn btn-danger"
                                            >
                                                Update
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <!-- /.tab-pane -->
                        </div>
                        <!-- /.tab-content -->
                    </div>
                    <!-- /.card-body -->
                </div>
                <!-- /.nav-tabs-custom -->
            </div>
        </div>
    </div>
</template>

<script>
export default {
    data() {
        return {
            form: new Form({
                id: "",
                name: "",
                email: "",
                password: "",
                type: "",
                bio: "",
                photo: ""
            })
        };
    },
    mounted() {
        console.log("Component mounted.");
        Fire.$on("AfterCreated", () => {
            window.location.href = "/profile";
        });
    },
    methods: {
        getProfilePhoto() {
            // x > 100 => Base64 photo or newly added photo
            let photo =
                this.form.photo.length > 100
                    ? this.form.photo
                    : "img/profile/" + this.form.photo;
            return photo;
        },
        updateProfile(e) {
            let file = e.target.files[0];
            let reader = new FileReader();

            if (file.size < 2097152) {
                reader.onloadend = file => {
                    this.form.photo = reader.result;
                };
                reader.readAsDataURL(file);
            } else {
                Swal.fire(
                    "Failed!",
                    "File Size should be less than 2MB",
                    "error"
                );
            }
        },
        updateInfo() {
            this.$Progress.start();
            this.form
                .put("api/profile/")
                .then(() => {
                    Fire.$emit("AfterCreated");
                    Swal.fire(
                        "Updated!",
                        "Profile has been updated successfully!",
                        "success"
                    );
                    this.$Progress.finish();
                })
                .catch(() => {
                    Swal.fire("Failed!", "Failed to Update", "error");
                    this.$Progress.fail();
                });
        }
    },
    created() {
        axios.get("api/profile").then(({ data }) => this.form.fill(data));
    }
};
</script>
